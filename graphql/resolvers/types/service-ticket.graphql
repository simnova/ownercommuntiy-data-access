type ServiceTicket implements MongoBase {
  community: Community!
  property: Property
  requestor: Member!
  assignedTo: Member
  title: String!
  description: String!
  requestBundle: [RequestItem]
  status: String!
  priority: Int!
  photos: [ServiceTicketPhoto]
  activityLog: [ServiceTicketActivityDetail]

  id: ObjectID!
  schemaVersion: String
  createdAt: DateTime
  updatedAt: DateTime
}

type ServiceTicketActivityDetail implements MongoEmbeddedBase {
  activityType: String!
  activityDescription: String!
  activityBy: Member!

  id: ObjectID!
  createdAt: DateTime
  updatedAt: DateTime
}

type ServiceTicketPhoto implements MongoEmbeddedBase {
  documentId: String!
  description: String!

  id: ObjectID!
  createdAt: DateTime
  updatedAt: DateTime
}

extend type Query {
  serviceTicket(id: ObjectID!): ServiceTicket
  serviceTicketsOpenByCommunity: [ServiceTicket]
  serviceTicketsOpenByRequestor: [ServiceTicket]
  serviceTicketsClosedByRequestor: [ServiceTicket]
  serviceTicketsAssignedToCurrentUser: [ServiceTicket]
  serviceTicketsByCommunityId(communityId: ID!): [ServiceTicket]
}

extend type Mutation {
  serviceTicketCreate(input: ServiceTicketCreateInput!): ServiceTicketMutationResult!
  serviceTicketUpdate(input: ServiceTicketUpdateInput!): ServiceTicketMutationResult!
  serviceTicketAddPhoto(input: ServiceTicketAddPhotoInput!): ServiceTicketPhotoAuthHeaderResult!
  serviceTicketRemovePhoto(input: ServiceTicketRemovePhotoInput!): ServiceTicketMutationResult!
  serviceTicketSubmit(input: ServiceTicketSubmitInput!): ServiceTicketMutationResult!
  serviceTicketAssign(input: ServiceTicketAssignInput!): ServiceTicketMutationResult!
  serviceTicketAddUpdateActivity(input: ServiceTicketAddUpdateActivityInput!): ServiceTicketMutationResult!
  serviceTicketChangeStatus(input: ServiceTicketChangeStatusInput!): ServiceTicketMutationResult!
  serviceTicketDelete(input: ServiceTicketDeleteInput!): ServiceTicketMutationResult!
}

type ServiceTicketMutationResult {
  status: MutationStatus!
  serviceTicket: ServiceTicket
}

input ServiceTicketDeleteInput {
  serviceTicketId: ObjectID!
}

input ServiceTicketCreateInput {
  propertyId: ObjectID
  requestorId: ObjectID
  title: String!
  description: String!
}

input ServiceTicketUpdateInput {
  serviceTicketId: ObjectID!
  propertyId: ObjectID
  title: String
  description: String
  priority: Int
  requestBundle: [ServiceTicketHVACMaintenanceRequestInput | ServiceTicketApplianceMaintenanceRequestInput]
}

input ServiceTicketHVACMaintenanceRequestInput{
  id: ObjectID
  kind: String!
  requestInfo: String
  hvacBrand: String
}

input ServiceTicketApplianceMaintenanceRequestInput {
  id: ObjectID
  kind: String!
  requestInfo: String
  applianceType: String
  applianceBrand: String
}

# union RequestItemInput = ServiceTicketHVACMaintenanceRequestInput | ServiceTicketApplianceMaintenanceRequestInput

input ServiceTicketAddPhotoInput {
  serviceTicketId: ObjectID!
  contentType: String!
  contentLength: String!
  description: String
}

input ServiceTicketRemovePhotoInput {
  serviceTicketId: ObjectID!
  photoId: ObjectID!
}

type ServiceTicketPhotoAuthHeaderResult implements MutationResult  {
  status: MutationStatus!
  authHeader: BlobAuthHeader
  serviceTicket: ServiceTicket
}

input ServiceTicketSubmitInput {
  serviceTicketId: ObjectID!
}

input ServiceTicketAssignInput {
  serviceTicketId: ObjectID!
  assignedToId: ObjectID
}

input ServiceTicketAddUpdateActivityInput {
  serviceTicketId: ObjectID!
  activityDescription: String!
}

input ServiceTicketChangeStatusInput {
  serviceTicketId: ObjectID!
  status: String!
  activityDescription: String
}

type HVACMaintenance implements MongoEmbeddedBase {
  id: ObjectID!
  createdAt: DateTime
  updatedAt: DateTime
  kind: String!
  requestInfo: String
  hvacBrand: String
}

type ApplianceMaintenance implements MongoEmbeddedBase {
  id: ObjectID!
  createdAt: DateTime
  updatedAt: DateTime
  kind: String!
  requestInfo: String
  applianceType: String
  applianceBrand: String
}

union RequestItem = HVACMaintenance | ApplianceMaintenance